<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Gemini Chat</title>
    <style>
      :root {
        --primary-color: #4a90e2;
        --bg-color: #f5f5f5;
        --chat-bg: #ffffff;
        --user-msg-bg: #e3f2fd;
        --ai-msg-bg: #f5f5f5;
      }

      body {
        max-width: 1000px;
        margin: 0 auto;
        padding: 20px;
        font-family: system-ui;
        background: var(--bg-color);
        color: #333;
      }

      .container {
        background: var(--chat-bg);
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        padding: 20px;
      }

      .header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 20px;
        padding-bottom: 20px;
        border-bottom: 1px solid #eee;
      }

      .settings {
        display: flex;
        gap: 15px;
      }

      .settings label {
        display: flex;
        align-items: center;
        gap: 5px;
      }

      .settings input {
        width: 60px;
        padding: 5px;
        border: 1px solid #ddd;
        border-radius: 4px;
      }

      .chat-container {
        height: 500px;
        overflow-y: auto;
        margin-bottom: 20px;
        padding: 10px;
        border-radius: 8px;
      }

      .message {
        margin: 10px 0;
        padding: 10px 15px;
        border-radius: 10px;
        max-width: 80%;
        word-wrap: break-word;
      }

      .user-message {
        background: var(--user-msg-bg);
        margin-left: auto;
        border-bottom-right-radius: 2px;
      }

      .ai-message {
        background: var(--ai-msg-bg);
        margin-right: auto;
        border-bottom-left-radius: 2px;
      }

      .input-container {
        display: flex;
        gap: 10px;
      }

      #prompt {
        flex-grow: 1;
        padding: 15px;
        border: 1px solid #ddd;
        border-radius: 8px;
        resize: none;
        font-family: inherit;
        font-size: 1rem;
        line-height: 1.5;
      }

      button {
        padding: 10px 20px;
        background: var(--primary-color);
        color: white;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-size: 1rem;
        transition: background 0.2s;
      }

      button:hover {
        background: #357abd;
      }

      button:disabled {
        background: #ccc;
        cursor: not-allowed;
      }

      .system-message {
        color: #666;
        font-style: italic;
        text-align: center;
        margin: 10px 0;
      }

      .typing-indicator {
        display: none;
        padding: 10px;
        background: var(--ai-msg-bg);
        border-radius: 10px;
        margin: 10px 0;
        width: fit-content;
      }

      .typing-indicator.visible {
        display: block;
      }

      .dots {
        display: flex;
        gap: 4px;
      }

      .dot {
        width: 8px;
        height: 8px;
        background: #999;
        border-radius: 50%;
        animation: bounce 1.4s infinite;
      }

      .dot:nth-child(2) { animation-delay: 0.2s; }
      .dot:nth-child(3) { animation-delay: 0.4s; }

      @keyframes bounce {
        0%, 100% { transform: translateY(0); }
        50% { transform: translateY(-4px); }
      }

      .error {
        color: #d32f2f;
        padding: 10px;
        margin: 10px 0;
        border-radius: 4px;
        display: none;
      }

      @media (max-width: 600px) {
        body {
          padding: 10px;
        }
        .message {
          max-width: 90%;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>ðŸ’¬ Gemini Chat</h1>
        <div class="settings">
          <label>
            Temperature:
            <input type="number" id="temperature" min="0" max="1" step="0.1" value="0.7">
          </label>
          <label>
            Creativity:
            <input type="number" id="topK" min="1" max="40" step="1" value="20">
          </label>
          <button id="reset">New Chat</button>
        </div>
      </div>

      <div id="error" class="error"></div>
      <div id="chat" class="chat-container"></div>
      
      <div class="typing-indicator" id="typing">
        <div class="dots">
          <div class="dot"></div>
          <div class="dot"></div>
          <div class="dot"></div>
        </div>
      </div>

      <div class="input-container">
        <textarea 
          id="prompt" 
          placeholder="Type your message here... (Press Enter to send, Shift+Enter for new line)"
          rows="2"
        ></textarea>
        <button id="submit">Send</button>
      </div>
    </div>

    <script>
      let session;
      const chat = document.getElementById('chat');
      const prompt = document.getElementById('prompt');
      const submit = document.getElementById('submit');
      const reset = document.getElementById('reset');
      const typing = document.getElementById('typing');
      const error = document.getElementById('error');
      const temperature = document.getElementById('temperature');
      const topK = document.getElementById('topK');

      function addMessage(text, isUser = false) {
        const div = document.createElement('div');
        div.className = `message ${isUser ? 'user-message' : 'ai-message'}`;
        div.textContent = text;
        chat.appendChild(div);
        chat.scrollTop = chat.scrollHeight;
      }

      function showError(message) {
        error.textContent = message;
        error.style.display = 'block';
        setTimeout(() => {
          error.style.display = 'none';
        }, 5000);
      }

      async function initSession() {
        try {
          if (!self.ai?.languageModel) {
            showError("Your browser doesn't support Gemini. Please use Chrome and enable AI features.");
            return;
          }

          session = await self.ai.languageModel.create({
            temperature: Number(temperature.value),
            topK: Number(topK.value),
            systemPrompt: `You are a helpful AI assistant powered by Google's Gemini. 
            You provide clear, accurate, and engaging responses while being conversational and natural.
            You can help with various tasks including writing, analysis, coding, and general questions.`
          });

          addMessage("ðŸ‘‹ Hi! I'm your AI assistant powered by Gemini. How can I help you today?", false);
          submit.disabled = false;
          prompt.disabled = false;
        } catch (error) {
          showError("Error initializing: " + error.message);
          console.error("Init error:", error);
        }
      }

      async function sendMessage() {
        const message = prompt.value.trim();
        if (!message) return;

        try {
          submit.disabled = true;
          prompt.disabled = true;
          typing.classList.add('visible');
          
          addMessage(message, true);
          prompt.value = '';

          if (!session) {
            await initSession();
          }

          const response = await session.prompt(message);
          addMessage(response, false);
        } catch (error) {
          showError("Error: " + error.message);
          console.error("Send error:", error);
        } finally {
          submit.disabled = false;
          prompt.disabled = false;
          typing.classList.remove('visible');
          prompt.focus();
        }
      }

      async function resetChat() {
        chat.innerHTML = '';
        if (session) {
          session.destroy();
          session = null;
        }
        await initSession();
      }

      // Event Listeners
      submit.addEventListener('click', sendMessage);

      prompt.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' && !e.shiftKey) {
          e.preventDefault();
          sendMessage();
        }
      });

      reset.addEventListener('click', resetChat);

      temperature.addEventListener('change', resetChat);
      topK.addEventListener('change', resetChat);

      // Initialize
      initSession();
    </script>
  </body>
</html>
